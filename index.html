<!DOCTYPE html>
<html>
  <head>
    <title>Asteroids</title>
    <meta name="viewport" content="width=device-width, height=device-height, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <meta name="HandheldFriendly" content="true" />
    
    <style media="screen">
      html, body, canvas, p{
        margin: 0;
        padding: 0;
        border: 0;
        overflow: hidden;
        background: #001;
        font-family: monospace;
      }

      
      .ui-loader {
        display: none;
      }

      canvas {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        cursor: crosshair;
        margin: 0 auto;
        display: block;
        /*-webkit-transform: scale(0.5) translateY(-50%) translateX(-50%);
        transform: scale(0.5) translateY(-50%) translateX(-50%);*/
        /*transform: scaleY(0.8);*/

      }
      asteroids-overlay {
        display: block;
        position: absolute;
        color: hsla(360, 100%, 100%, 0.9);
        top: 0;
        left: 0;
        padding: 5px;
        font-weight: bold;
        font-size: 20px;
        text-shadow: 0 1px 2px hsla(360, 100%, 0%, 0.75), 0 -1px 2px hsla(360, 100%, 100%, 0.5);
        background: hsla(360, 100%, 0%, 0.8);
        text-align: center;
        line-height: 13px;
      }
      asteroids-overlay p {
        background: transparent;
        display: inline;
        font-size: 13px;
        padding: 100px;
      }
    </style>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
  <script src="http://code.jquery.com/mobile/1.4.5/jquery.mobile-1.4.5.js" charset="utf-8"></script>
  </head>
  <body>
    <canvas id="game-canvas"></canvas>
    <asteroids-overlay></asteroids-overlay>


    <script src="lib/movingObject.js" charset="utf-8"></script>
    <script src="lib/utils.js" charset="utf-8"></script>
    <script src="lib/ship.js" charset="utf-8"></script>
    <script src="lib/asteroid.js" charset="utf-8"></script>
    <script src="lib/game.js" charset="utf-8"></script>
    <script src="lib/gameView.js" charset="utf-8"></script>
    <script src="lib/bullet.js" charset="utf-8"></script>
    <script src="vendor/keymaster.js"></script>
    <script src="vendor/gyronorm.complete.js"></script>

    <script>
      var canvasEl = document.getElementById("game-canvas");
      canvasEl.setAttribute("width", window.innerWidth * 2);
      canvasEl.setAttribute("height", window.innerHeight * 2);
      var ctx = canvasEl.getContext('2d');
      Asteroids = Asteroids || {};
      var game = new Asteroids.Game(canvasEl.width, canvasEl.height);
      // Asteroids.Game.DIM_X = window.innerWidth;
      // Asteroids.Game.DIM_Y = window.innerHeight;
      var gameView = new Asteroids.GameView(game, ctx);
      gameView.start();
      var resizing = false;
      // $(window).on("resize", function() {
      //   if (resizing) {
      //     return;
      //   }
      //   setTimeout(function() {
      //     resizing = false;
      //     var oldW = ctx.canvas.width, oldH = ctx.canvas.height;
      //     Asteroids.Game.DIM_X = window.innerWidth;
      //     Asteroids.Game.DIM_Y = window.innerHeight;
      //     canvasEl.setAttribute("height", window.innerHeight);
      //     canvasEl.setAttribute("width", window.innerWidth);
      //     ctx.scale(1 / (oldW / window.innerWidth), 1 / (oldH / window.innerHeight));
      //   }, 50);
      // });


        var gn = new GyroNorm();

        gn.init({frequency: 1000/30, decimalCount: 5}).then(function(){
          var timeouts = []
            gn.start(function(data){
                // Process:
                // data.do.alpha    ( deviceorientation event alpha value )
                // data.do.beta     ( deviceorientation event beta value )
                // data.do.gamma    ( deviceorientation event gamma value )
                // data.do.absolute ( deviceorientation event absolute value )



                // data.dm.x        ( devicemotion event acceleration x value )
                // data.dm.y        ( devicemotion event acceleration y value )
                // data.dm.z        ( devicemotion event acceleration z value )

                // data.dm.gx       ( devicemotion event accelerationIncludingGravity x value )
                // data.dm.gy       ( devicemotion event accelerationIncludingGravity y value )
                // data.dm.gz       ( devicemotion event accelerationIncludingGravity z value )

                // data.dm.alpha    ( devicemotion event rotationRate alpha value )
                // data.dm.beta     ( devicemotion event rotationRate beta value )
                // data.dm.gamma    ( devicemotion event rotationRate gamma value )

                // game.allObjects().forEach(function (obj) {
                //   obj.vel[0] += ;
                //   obj.vel[1] += ;
                //
                // });
                game.ship.power([data.do.gamma / 90, data.do.beta / 180]);
                // game.ship.power([((data.do.gamma > 0) - (data.do.gamma < 0)) / 10,((data.do.beta > 0) - (data.do.beta < 0)) / 10]);
                // game.ship.accel = ;
                // game.ship.vel = game.ship.vel[0] == 0 && game.ship.vel[1] == 0 ? [Number.MIN_VALUE, Number.MIN_VALUE] : game.ship.vel;
            });
        }).catch(function(e){
          // Catch if the DeviceOrientation or DeviceMotion is not supported by the browser or device
        });
    </script>
  </body>
</html>
